---
title: "Shutkevich_HW6"
output: html_document
date: "2024-04-16"
---

**Задание 6**

При выполнении этого домашнего задания вам необходимо посчитать выборки для различных типов точек. Напишите соответствующий код, пользуясь указанными формулами.

Пусть наш спонсор заинтересован, чтобы исследование имело 80% мощность, а уровень значимости — 5%, ожидаемый drop-out rate = 10%.

**Задача 1**

Рассчитайте выборку для исследования терапевтической эквивалентности для двухпериодного cross-over дизайна. Из предыдущих исследований известно, что дисперсия составляет 20% (\sigma\*m = 0.20), а разница средних составляет −10% (\*\varepsilon=\mu{\text {test }}-\mu\_{\text {reference }}). Клиницисты сообщают нам, что клинически значимая разница составляет 25% (\delta = 0.25).

Воспользуйтесь следующей формулой:

n_1=n_2=\frac{\left(Z_{\alpha / 2}+Z_\beta\right)^2 \sigma_m^2}{2 *(\delta-|\varepsilon|)^2}, n=n_1+n_2

```{r}
# Устанавливаем значения параметров
alpha <- 0.05
beta <- 0.20
sigma_m <- 0.20
epsilon <- -0.10
delta <- 0.25
power <- 0.80
drop_out_rate <- 0.10
```

В этом задании мы рассчитываем размер выборки для двухпериодного cross-over дизайна. Это означает, что каждый участник будет получать оба лечения (тестовое и контрольное) в разные периоды времени.

Дисперсия (σ²): Задана как 20% (0.20). Это мера изменчивости результатов лечения между участниками.

Разница средних (ε): Задана как -10% (-0.10). Это ожидаемая разница в эффективности между тестовым и контрольным лечением.

Клинически значимая разница (δ): Задана как 25% (0.25). Это минимальная разница в эффективности, которая считается клинически важной.

Уровень значимости (α): Задан как 5% (0.05). Это вероятность ошибочно заключить, что лечения различаются, когда на самом деле они эквивалентны.

Мощность (1 - β): Задана как 80% (0.80). Это вероятность правильно обнаружить разницу в эффективности лечений, если она действительно существует.

Drop-out rate: Задан как 10% (0.10). Это ожидаемый процент участников, которые не завершат исследование.

Формула для расчета размера выборки учитывает эти параметры и использует Z-значения, которые соответствуют уровню значимости и мощности. Размер выборки корректируется на drop-out rate, чтобы обеспечить достаточное количество участников до конца исследования.

```{r}
# Рассчитываем Z-значения
Z_alpha_2 <- qnorm(1 - alpha / 2)
Z_beta <- qnorm(power)

# Рассчитываем размер выборки для каждой группы
n1 <- n2 <- ((Z_alpha_2 + Z_beta)^2 * sigma_m^2) / (2 * (delta - abs(epsilon))^2)

# Корректируем на drop-out rate и округляем в большую сторону
n1_adjusted <- ceiling(n1 / (1 - drop_out_rate))
n2_adjusted <- ceiling(n2 / (1 - drop_out_rate))

# Рассчитываем общий размер выборки
n_total <- n1_adjusted + n2_adjusted

# Выводим результат
cat("Размер выборки для каждой группы (с учетом drop-out rate):", n1_adjusted, "\n")
cat("Общий размер выборки:", n_total, "\n")
```

**Задача 2**

Рассчитайте выборку для гипотезы non-inferiority для двухвыборочного параллельного дизайна. Пусть клинически значимая разница \delta = -0.1, то есть мы ожидаем разницу не меньше 10%, а долю ответов для тестового препарата = 0.65, в то время как нам известно из предыдущих исследований, что доля ответов у препарата сравнения составляет p_1 = 0.85. Соотношение групп равно k = 1.

Воспользуйтесь следующей формулой: n_1=n_2=\frac{\left(Z_{\alpha / 2}+Z_\beta\right)^2\left(p_1^\left(1-p_1\right)+p_2^\left(1-p_2\right)\right)}{\left(p_1-p_2-\delta\right)^2}, n=n_1+n_2

```{r}
# Устанавливаем значения параметров
alpha <- 0.05
beta <- 0.20
delta <- -0.10
p1 <- 0.85
p2 <- 0.65
k <- 1
power <- 0.80
drop_out_rate <- 0.10
```

Здесь целью является доказательство, что тестовое лечение не уступает контрольному на заданную клинически значимую разницу.

Клинически значимая разница (δ): Задана как -10% (-0.10). Это порог, ниже которого тестовое лечение считается не хуже контрольного.

Доля ответов (p1 и p2): Заданы как 85% (0.85) для контрольного и 65% (0.65) для тестового лечения. Это ожидаемые доли успешных исходов лечения.

Соотношение групп (k): Задано как 1, что означает равное количество участников в обеих группах.

Уровень значимости (α): Задан как 5% (0.05). Это вероятность ошибочно заключить, что лечения различаются, когда на самом деле они эквивалентны.

Мощность (1 - β): Задана как 80% (0.80). Это вероятность правильно обнаружить разницу в эффективности лечений, если она действительно существует.

Формула учитывает вероятности успеха для обеих групп и предполагаемую разницу в эффективности, а также уровень значимости и мощность. Размер выборки также корректируется на drop-out rate.

```{r}
# Рассчитываем Z-значения
Z_alpha_2 <- qnorm(1 - alpha / 2)
Z_beta <- qnorm(power)

# Рассчитываем размер выборки для каждой группы
n1 <- n2 <- ((Z_alpha_2 + Z_beta)^2 * (p1 * (1 - p1) + p2 * (1 - p2))) / ((p1 - p2 - delta)^2)

# Корректируем на drop-out rate и округляем в большую сторону
n1_adjusted <- ceiling(n1 / (1 - drop_out_rate))
n2_adjusted <- ceiling(n2 / (1 - drop_out_rate))

# Рассчитываем общий размер выборки и округляем в большую сторону
n_total <- n1_adjusted + n2_adjusted

# Выводим результат
cat("Размер выборки для каждой группы (с учетом drop-out rate):", n1_adjusted, "\n")
cat("Общий размер выборки:", n_total, "\n")
```

**Задача 3**

Рассчитайте выборку для гипотезы equality для следующего исследования. Мы хотим сравнить новую терапию инфекции, присоединяющейся в больничных условиях у пациентов с ожогами, с золотым стандартом, основываясь на данных, анализируемых с помощью регрессии Кокса. Пусть отношение рисков «золотой стандарт / новая терапия», hazard ratio, HR = 2. Мы предполагаем, что 80% пациентов (d = 0.8) могут столкнуться с этим заболеванием. Соотношения групп терапии равны (p_1=p_2=0.5).

Воспользуйтесь следующей формулой: n_1=n_2=\frac{\left(Z_{\alpha / 2}+Z_\beta\right)^2}{\ln (H R)^2 p_1 p_2 d}, n=n_1+n_2

```{r}
# Устанавливаем значения параметров
alpha <- 0.05
beta <- 0.20
HR <- 2
d <- 0.8
p1 <- p2 <- 0.5
power <- 0.80
drop_out_rate <- 0.10
```

Целью является сравнение новой терапии с золотым стандартом на основе анализа регрессии Кокса.

Hazard ratio (HR): Задано как 2. Это отношение рисков между группами, где значение больше 1 указывает на больший риск события в группе золотого стандарта по сравнению с новой терапией.

Доля пациентов (d): Задана как 80% (0.8). Это ожидаемая доля пациентов, которые столкнутся с заболеванием.

Соотношения групп терапии (p1 и p2): Заданы как 50% (0.5) для обеих групп, что означает равное распределение пациентов между терапиями.

Уровень значимости (α): Задан как 5% (0.05). Это вероятность ошибочно заключить, что лечения различаются, когда на самом деле они эквивалентны.

Мощность (1 - β): Задана как 80% (0.80). Это вероятность правильно обнаружить разницу в эффективности лечений, если она действительно существует.

Формула учитывает отношение рисков, долю пациентов, которые могут столкнуться с заболеванием, и соотношения групп терапии, а также уровень значимости и мощность. Размер выборки корректируется на drop-out rate.

```{r}
# Рассчитываем Z-значения
Z_alpha_2 <- qnorm(1 - alpha / 2)
Z_beta <- qnorm(power)

# Рассчитываем размер выборки для каждой группы
n1 <- n2 <- ((Z_alpha_2 + Z_beta)^2) / (log(HR)^2 * p1 * p2 * d)

# Корректируем на drop-out rate и округляем в большую сторону
n1_adjusted <- ceiling(n1 / (1 - drop_out_rate))
n2_adjusted <- ceiling(n2 / (1 - drop_out_rate))

# Рассчитываем общий размер выборки и округляем в большую сторону
n_total <- n1_adjusted + n2_adjusted

# Выводим результат
cat("Размер выборки для каждой группы (с учетом drop-out rate):", n1_adjusted, "\n")
cat("Общий размер выборки:", n_total, "\n")
```
